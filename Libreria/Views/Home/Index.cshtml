@model List<Libreria.Models.Libro>

@{
    Layout = null;

    // Ordenar los libros por Id en orden descendente y luego tomar los últimos 12
    var libros = Model.OrderByDescending(l => l.Id)
                      .Take(12)
                      .ToList();
}

@Html.Partial("_navbar")

<div class="container content mt-2">
    <h5 class="mb-4">¡Bienvenido a Librería El Maestro!</h5>
    <p class="lead mb-5">Explora nuestro catálogo, encuentra nuestra sucursal, ponte en contacto con nosotros o aprende más sobre nuestra historia.</p>

    <h5 class="text-dark fw-bold text-center" style="font-size: 1.50rem;">ÚLTIMOS LIBROS AGREGADOS</h5>

    @for (int i = 0; i < libros.Count; i += 3)
    {
        <div class="row">
            @for (int j = i; j < i + 3 && j < libros.Count; j++)
            {
                <div class="col-lg-4 col-md-6 mb-4">
                    <a asp-action="Detalles" asp-route-id="@libros[j].Id" class="text-decoration-none text-dark">
                        <div class="card d-flex flex-row h-100">
                            @if (libros[j].Portada != null && libros[j].Portada.Length > 0)
                            {
                                <img src="data:image/jpeg;base64,@Convert.ToBase64String(libros[j].Portada)" alt="@libros[j].Titulo" class="img-fluid" style="width: 120px; height: 180px; object-fit: cover;" />
                            }
                            else
                            {
                                <img src="~/img/no-portada.png" alt="No hay portada disponible" class="img-fluid" style="width: 120px; height: 180px; object-fit: cover;" />
                            }
                            <div class="card-body d-flex flex-column">
                                <h6 class="card-title mb-2" style="overflow: hidden; text-overflow: ellipsis; white-space: normal; margin: 0;">@libros[j].Titulo</h6>
                                <p class="card-text text-muted small mb-2">@libros[j].Autor</p>
                                <p class="card-text text-primary small mb-1">RD @libros[j].Precio.ToString("C")</p>
                            </div>
                        </div>
                    </a>
                </div>
            }
        </div>
    }
</div>